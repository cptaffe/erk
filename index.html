<!DOCTYPE html>
<html>
	<head>
		<style>
			@import url(https://fonts.googleapis.com/css?family=Roboto);
			* {
				margin: none;
				padding: none;
			}
			body {
				background-color: rgba(0, 0, 0, 0.7);

				/* Fonts */
				color: white;
				font-size: 10pt;
				font-family: "Roboto", sans-serif;
			}
			#messages {
				margin: 10px;
			}
			.msg {
				margin: 5px;
			}
			#response {
				color: black;
				font-size: inherit;
				font-family: inherit;

				background-color: rgba(255, 255, 255, 0.5);
				outline: none;
				resize: none;
				border: none;

				width: 100%;
				position: fixed;
				bottom: 0px;
				left: 0px;
				padding: 5px;
				padding-bottom: 0px;

				height: 25px;
			}
		</style>
	</head>
	<body>
		<div id='content'></div>
		<script>
			'use strict';
			let $ = require('jquery'),
				irc = require('irc')

			let config = require('./config.json')

			class Bundle {
				constructor(elem) {
					this.elem = elem
				}

				get element() {
					return this.elem
				}
			}

			class View {
				constructor(bundle) {
					this.bundle = bundle
				}

				render() {
					return this.bundle.element
				}
			}

			class ListView extends View {
				constructor(bundle, view, elems) {
					super(bundle)
					this.view = view
					this.elems = elems
				}

				// returns rendered element
				render() {
					let v = this.view
					return $(super.render()).append(this.elems.map(function(i) {
						return new v(new Bundle(document.createElement('div')), i).render()
					})).get()
				}
			}

			class Channel {
				constructor(client, chan) {
					this.client = client
					this.chan = chan
				}

				toString() {
					return this.chan
				}

				connect() {
					this.client.join(this.chan, function(from, to, message) {

					})
				}
			}

			class ChannelView extends View {
				constructor(bundle, chan) {
					super(bundle)
					this.chan = chan
				}

				// returns rendered element
				render() {
					let chan = this.chan
					return $(super.render()).text(this.chan).click(function() {
						chan.connect()
					})
				}
			}

			// IRC Client
			let client = new irc.Client('irc.mozilla.org', 'erktest', config);

			// Set new UI
			new ListView(new Bundle($('#content').get()), ChannelView, [new Channel(client, '#firefox'), new Channel(client, '#haskell')]).render()

			// Register handlers
			client.addListener('registered', function(message) {
				console.log('connected to server.')
			})
			client.addListener('motd', function(motd) {
				console.log('motd: '+motd)
			})
			client.addListener('names', function(channel, names) {
				console.log('names on '+channel+': '+names)
			})
			client.addListener('topic', function(channel, topic, nick, message) {
				console.log(channel+' topic: '+topic+' set by '+nick)
			})
			client.addListener('join', function(channel, nick, message) {
				console.log(nick+' joined '+channel)
			})
			client.addListener('part', function(channel, nick, reason, message) {
				console.log(nick+' left '+channel+': '+reason)
			})
			client.addListener('quit', function(nick, reason, channels, message) {
				console.log(nick+' quit '+channels+': '+reason)
			})
			client.addListener('kick', function(channel, nick, by, reason, message) {
				console.log(nick+' kicked from '+channel+' by '+by+': '+reason)
			})
			client.addListener('kill', function(nick, reason, channels, message) {
				console.log(nick+' killed from '+channels+': '+reason)
			})
			client.addListener('message#', function(nick, to, text, message) {
				console.log(nick+'=>'+to+': '+text)
			})
			client.addListener('selfMessage', function(to, text) {
				console.log('you=>'+to+': '+text)
			})
			client.addListener('notice', function(nick, to, text, message) {
				console.log('[notice] '+nick+'=>'+to+': '+text)
			})
			client.addListener('ping', function(server) {
				console.log('[ping] '+server)
			})
			client.addListener('pm', function(nick, text, message) {
				console.log(nick+'=>you: '+text)
			})
			client.addListener('nick', function(oldnick, newnick, channels, message) {
				console.log(oldnick+' is now '+newnick+' on '+channels)
			})
			client.addListener('invite', function(channel, from, message) {
				console.log('invite to '+channel+' from '+from)
			})
			client.addListener('+mode', function(channel, by, mode, argument, message) {})
			client.addListener('-mode', function(channel, by, mode, argument, message) {})
			client.addListener('whois', function(info) {})
			client.addListener('error', function(message) {
				console.log('error: ', message);
			})
			client.addListener('action', function(from, to, text, message) {})
			client.addListener('channellist', function(channel_list) {})
			client.addListener('raw', function(message) {})

			// Client to Client
			client.addListener('ctcp-notice', function(from, to, text, message) {})
			client.addListener('ctcp-privmsg', function(from, to, text, message) {})
			client.addListener('ctcp-version', function(from, to, message) {})

		</script>
	</body>
</html>
